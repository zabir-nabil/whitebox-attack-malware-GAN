import numpy as np
import malware_gan 

import torch
from torch import nn

from detector import train

NUM_FEATURES = 2

detector, results = train(NUM_FEATURES)

X_0, y_0, X_1, y_1 = malware_gan.ben_mal_split("data/apg-X.json", "data/apg-y.json", NUM_FEATURES)
mal_data = malware_gan.DrebinDataset(X_0, y_0)
ben_data = malware_gan.DrebinDataset(X_1, y_1)

malgan = malware_gan.MalGAN(mal_data,
                ben_data,
                Z=2,
                h_gen=[32, 32],
                h_discrim=[32, 32],
                g_hidden=nn.LeakyReLU,
                detector_type="SVM",
                detector=detector)
malgan.fit(1, quiet_mode=True)
print("Training done")
results = malgan.measure_and_export_results()

print(results)
